{"version":3,"file":"sw-manager--CjsvoUl.js","sources":["../../../public/assets/js/sw-manager.js"],"sourcesContent":["// Service Worker Registration with Auto-Update\n// Universal cache-busting service worker helper\n\nclass ServiceWorkerManager {\n  constructor() {\n    this.registering = false;\n    this.registration = null;\n  }\n\n  async initialize() {\n    if (!('serviceWorker' in navigator) || this.registering) {\n      return;\n    }\n\n    this.registering = true;\n\n    try {\n      this.registration = await navigator.serviceWorker.register('/sw.js');\n      console.log('SW registered: ', this.registration);\n\n      // Check for updates frequently\n      this.startUpdateChecking();\n\n      // Handle updates\n      this.setupUpdateHandling();\n\n      // Handle controller changes\n      this.setupControllerChangeHandling();\n    } catch (error) {\n      console.error('SW registration failed: ', error);\n    }\n  }\n\n  startUpdateChecking() {\n    // Check for updates immediately and then every 5 seconds\n    this.registration.update();\n\n    setInterval(() => {\n      this.registration.update();\n    }, 5000);\n  }\n\n  setupUpdateHandling() {\n    this.registration.addEventListener('updatefound', () => {\n      const newWorker = this.registration.installing;\n      console.log('New service worker found, installing...');\n\n      newWorker.addEventListener('statechange', () => {\n        if (newWorker.state === 'installed') {\n          if (navigator.serviceWorker.controller) {\n            // New version available, force immediate update\n            console.log('New version available, updating immediately...');\n            newWorker.postMessage({ type: 'SKIP_WAITING' });\n          } else {\n            console.log('App is cached for the first time');\n          }\n        }\n      });\n    });\n  }\n\n  setupControllerChangeHandling() {\n    navigator.serviceWorker.addEventListener('controllerchange', () => {\n      console.log('Service worker controller changed, reloading page...');\n      window.location.reload();\n    });\n  }\n\n  async clearAllCaches() {\n    console.log('Clearing all caches...');\n\n    // Tell service worker to clear its caches\n    if (this.registration?.active) {\n      this.registration.active.postMessage({ type: 'CLEAR_CACHE' });\n    }\n\n    // Clear all caches from this context\n    if ('caches' in window) {\n      const cacheNames = await caches.keys();\n      await Promise.all(cacheNames.map(name => caches.delete(name)));\n    }\n\n    console.log('All caches cleared, reloading...');\n    window.location.reload();\n  }\n\n  async forceUpdate() {\n    if (this.registration) {\n      await this.registration.update();\n      console.log('Forced service worker update check');\n    }\n  }\n}\n\n// Global instance\nconst swManager = new ServiceWorkerManager();\n\n// Auto-initialize when DOM is ready\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', () => swManager.initialize());\n} else {\n  swManager.initialize();\n}\n\n// Expose global functions for debugging\nwindow.clearAllCaches = () => swManager.clearAllCaches();\nwindow.forceUpdate = () => swManager.forceUpdate();\nwindow.swManager = swManager;\n\nexport { swManager, ServiceWorkerManager };\n"],"names":["ServiceWorkerManager","error","newWorker","cacheNames","name","swManager"],"mappings":"AAGA,MAAMA,CAAqB,CACzB,aAAc,CACZ,KAAK,YAAc,GACnB,KAAK,aAAe,IACxB,CAEE,MAAM,YAAa,CACjB,GAAI,IAAE,kBAAmB,YAAc,KAAK,aAI5C,MAAK,YAAc,GAEnB,GAAI,CACF,KAAK,aAAe,MAAM,UAAU,cAAc,SAAS,QAAQ,EACnE,QAAQ,IAAI,kBAAmB,KAAK,YAAY,EAGhD,KAAK,oBAAmB,EAGxB,KAAK,oBAAmB,EAGxB,KAAK,8BAA6B,CACxC,OAAaC,EAAO,CACd,QAAQ,MAAM,2BAA4BA,CAAK,CACrD,EACA,CAEE,qBAAsB,CAEpB,KAAK,aAAa,OAAM,EAExB,YAAY,IAAM,CAChB,KAAK,aAAa,OAAM,CAC9B,EAAO,GAAI,CACX,CAEE,qBAAsB,CACpB,KAAK,aAAa,iBAAiB,cAAe,IAAM,CACtD,MAAMC,EAAY,KAAK,aAAa,WACpC,QAAQ,IAAI,yCAAyC,EAErDA,EAAU,iBAAiB,cAAe,IAAM,CAC1CA,EAAU,QAAU,cAClB,UAAU,cAAc,YAE1B,QAAQ,IAAI,gDAAgD,EAC5DA,EAAU,YAAY,CAAE,KAAM,cAAc,CAAE,GAE9C,QAAQ,IAAI,kCAAkC,EAG1D,CAAO,CACP,CAAK,CACL,CAEE,+BAAgC,CAC9B,UAAU,cAAc,iBAAiB,mBAAoB,IAAM,CACjE,QAAQ,IAAI,sDAAsD,EAClE,OAAO,SAAS,OAAM,CAC5B,CAAK,CACL,CAEE,MAAM,gBAAiB,CASrB,GARA,QAAQ,IAAI,wBAAwB,EAGhC,KAAK,cAAc,QACrB,KAAK,aAAa,OAAO,YAAY,CAAE,KAAM,cAAe,EAI1D,WAAY,OAAQ,CACtB,MAAMC,EAAa,MAAM,OAAO,KAAI,EACpC,MAAM,QAAQ,IAAIA,EAAW,IAAIC,GAAQ,OAAO,OAAOA,CAAI,CAAC,CAAC,CACnE,CAEI,QAAQ,IAAI,kCAAkC,EAC9C,OAAO,SAAS,OAAM,CAC1B,CAEE,MAAM,aAAc,CACd,KAAK,eACP,MAAM,KAAK,aAAa,OAAM,EAC9B,QAAQ,IAAI,oCAAoC,EAEtD,CACA,CAGA,MAAMC,EAAY,IAAIL,EAGlB,SAAS,aAAe,UAC1B,SAAS,iBAAiB,mBAAoB,IAAMK,EAAU,WAAU,CAAE,EAE1EA,EAAU,WAAU,EAItB,OAAO,eAAiB,IAAMA,EAAU,eAAc,EACtD,OAAO,YAAc,IAAMA,EAAU,YAAW,EAChD,OAAO,UAAYA"}