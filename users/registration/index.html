<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Register - 3 Ball Network</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Urbanist:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    /* ... your existing CSS ... */
  </style>
</head>
<body>
  <div class="banner-logo">
    <img src="../../Media/logo.png" alt="3 Ball Network Logo" class="banner-logo-img">
  </div>
  <div class="register-card">
    <h2>Register</h2>
    <p>Join the 3 Ball Network and connect with players, coaches, scouts, and fans!</p>
    <form id="register-form" autocomplete="off">
      <label for="reg-email">Email</label>
      <input type="email" id="reg-email" required autocomplete="username">
      <label for="reg-password">Create Password</label>
      <span class="password-container">
        <input type="password" id="reg-password" required autocomplete="new-password">
        <button type="button" id="toggle-password">Show</button>
      </span>
      <label for="reg-role">Role</label>
      <select id="reg-role" required>
        <option value="">Select Role</option>
        <option value="player">Player</option>
        <option value="coach">Coach</option>
        <option value="scout">Scout</option>
        <option value="fan">Fan</option>
      </select>
      <div id="role-fields"></div>
      <button type="submit">Register</button>
      <div id="register-loading" style="display:none;">Loading...</div>
      <div id="reg-error"></div>
    </form>
    <div class="login-link">
      Already have an account? <a href="../login.html">Login here</a>
    </div>
  </div>
  <script>
const roleFields = document.getElementById('role-fields');
const roleSelect = document.getElementById('reg-role');

function getStateOptions() {
  const states = [
    { abbr: "AL", name: "Alabama" }, { abbr: "AK", name: "Alaska" }, { abbr: "AZ", name: "Arizona" },
    { abbr: "AR", name: "Arkansas" }, { abbr: "CA", name: "California" }, { abbr: "CO", name: "Colorado" },
    { abbr: "CT", name: "Connecticut" }, { abbr: "DE", name: "Delaware" }, { abbr: "FL", name: "Florida" },
    { abbr: "GA", name: "Georgia" }, { abbr: "HI", name: "Hawaii" }, { abbr: "ID", name: "Idaho" },
    { abbr: "IL", name: "Illinois" }, { abbr: "IN", name: "Indiana" }, { abbr: "IA", name: "Iowa" },
    { abbr: "KS", name: "Kansas" }, { abbr: "KY", name: "Kentucky" }, { abbr: "LA", name: "Louisiana" },
    { abbr: "ME", name: "Maine" }, { abbr: "MD", name: "Maryland" }, { abbr: "MA", name: "Massachusetts" },
    { abbr: "MI", name: "Michigan" }, { abbr: "MN", name: "Minnesota" }, { abbr: "MS", name: "Mississippi" },
    { abbr: "MO", name: "Missouri" }, { abbr: "MT", name: "Montana" }, { abbr: "NE", name: "Nebraska" },
    { abbr: "NV", name: "Nevada" }, { abbr: "NH", name: "New Hampshire" }, { abbr: "NJ", name: "New Jersey" },
    { abbr: "NM", name: "New Mexico" }, { abbr: "NY", name: "New York" }, { abbr: "NC", name: "North Carolina" },
    { abbr: "ND", name: "North Dakota" }, { abbr: "OH", name: "Ohio" }, { abbr: "OK", name: "Oklahoma" },
    { abbr: "OR", name: "Oregon" }, { abbr: "PA", name: "Pennsylvania" }, { abbr: "RI", name: "Rhode Island" },
    { abbr: "SC", name: "South Carolina" }, { abbr: "SD", name: "South Dakota" }, { abbr: "TN", name: "Tennessee" },
    { abbr: "TX", name: "Texas" }, { abbr: "UT", name: "Utah" }, { abbr: "VT", name: "Vermont" },
    { abbr: "VA", name: "Virginia" }, { abbr: "WA", name: "Washington" }, { abbr: "WV", name: "West Virginia" },
    { abbr: "WI", name: "Wisconsin" }, { abbr: "WY", name: "Wyoming" }
  ];
  return `<option value="">Select State</option>` +
    states.map(state => `<option value="${state.abbr}">${state.name}</option>`).join('');
}

function getCommonFields(role) {
  return `
    <label for="${role}-first">First Name</label>
    <input type="text" id="${role}-first" required>
    <label for="${role}-last">Last Name</label>
    <input type="text" id="${role}-last" required>
    <label for="${role}-state">State</label>
    <select id="${role}-state" required>${getStateOptions()}</select>
    <label for="${role}-city">City</label>
    <select id="${role}-city" required disabled><option value="">Select City</option></select>
    ${(role === "player" || role === "coach") ? `
      <label for="${role}-school">School</label>
      <select id="${role}-school" required disabled><option value="">Select School</option></select>
    ` : ""}
    <label for="${role}-phone">Phone Number</label>
    <input type="tel" id="${role}-phone" required pattern="[0-9]{10,}">
  `;
}

const fieldsByRole = {
  player: getCommonFields("player") + `
    <label for="player-height-ft">Height</label>
    <div style="display:flex;gap:0.5em;">
      <input type="number" id="player-height-ft" min="4" max="7" placeholder="Feet" required style="flex:1;">
      <input type="number" id="player-height-in" min="0" max="11" placeholder="Inches" required style="flex:1;">
    </div>
    <label for="player-weight">Weight (lbs)</label>
    <input type="number" id="player-weight" min="80" max="400" required>
    <label for="player-position">Position</label>
    <input type="text" id="player-position" required>
    <label>Gender</label>
    <select id="player-gender" required>
      <option value="">Select Gender</option>
      <option value="male">Male</option>
      <option value="female">Female</option>
    </select>
  `,
  coach: getCommonFields("coach"),
  scout: getCommonFields("scout"),
  fan: getCommonFields("fan")
};

roleSelect.addEventListener('change', function() {
  roleFields.innerHTML = fieldsByRole[this.value] || '';
  setTimeout(() => addDependentDropdowns(this.value), 0); // Wait for DOM update
});

function addDependentDropdowns(role) {
  if (!role) return;
  const stateSel = document.getElementById(`${role}-state`);
  const citySel = document.getElementById(`${role}-city`);
  const schoolSel = document.getElementById(`${role}-school`);

  // Remove previous listeners by cloning
  if (stateSel) {
    const newStateSel = stateSel.cloneNode(true);
    stateSel.parentNode.replaceChild(newStateSel, stateSel);
    stateSel = newStateSel;
  }
  if (citySel) {
    const newCitySel = citySel.cloneNode(true);
    citySel.parentNode.replaceChild(newCitySel, citySel);
    citySel = newCitySel;
  }
  if (schoolSel) {
    const newSchoolSel = schoolSel.cloneNode(true);
    schoolSel.parentNode.replaceChild(newSchoolSel, schoolSel);
    schoolSel = newSchoolSel;
  }

  // State -> City
  if (stateSel && citySel) {
    stateSel.addEventListener('change', async function() {
      citySel.innerHTML = `<option value="">Loading...</option>`;
      citySel.disabled = true;
      if (schoolSel) {
        schoolSel.innerHTML = `<option value="">Select School</option>`;
        schoolSel.disabled = true;
      }
      if (!this.value) {
        citySel.innerHTML = `<option value="">Select City</option>`;
        return;
      }
      try {
        const res = await fetch(`/getCities?state=${encodeURIComponent(this.value)}`);
        const data = await res.json();
        let cities = [];
        if (data && data.cities) {
          cities = data.cities;
        } else if (Array.isArray(data)) {
          cities = data;
        }
        citySel.innerHTML = `<option value="">Select City</option>` +
          cities.map(city => `<option value="${city}">${city}</option>`).join('');
        citySel.disabled = false;
      } catch (e) {
        citySel.innerHTML = `<option value="">Select City</option>`;
        citySel.disabled = true;
      }
    });
  }

  // City -> School (for player/coach)
  if (citySel && schoolSel) {
    citySel.addEventListener('change', async function() {
      schoolSel.innerHTML = `<option value="">Loading...</option>`;
      schoolSel.disabled = true;
      if (!this.value) {
        schoolSel.innerHTML = `<option value="">Select School</option>`;
        return;
      }
      try {
        const state = stateSel.value;
        const res = await fetch(`/getSchools?state=${encodeURIComponent(state)}&city=${encodeURIComponent(this.value)}`);
        const data = await res.json();
        let schools = [];
        if (data && data.schools) {
          schools = data.schools;
        } else if (data && data.schoolList) {
          schools = data.schoolList;
        }
        schoolSel.innerHTML = `<option value="">Select School</option>` +
          schools.map(s => `<option value="${s.schoolName}">${s.schoolName}</option>`).join('');
        schoolSel.disabled = false;
      } catch (e) {
        schoolSel.innerHTML = `<option value="">Select School</option>`;
        schoolSel.disabled = true;
      }
    });
  }
}

// Password visibility toggle
document.addEventListener('DOMContentLoaded', () => {
  const pwInput = document.getElementById('reg-password');
  const pwBtn = document.getElementById('toggle-password');
  if (pwBtn && pwInput) {
    pwBtn.onclick = () => {
      if (pwInput.type === "password") {
        pwInput.type = "text";
        pwBtn.textContent = "Hide";
      } else {
        pwInput.type = "password";
        pwBtn.textContent = "Show";
      }
    };
  }
});
  </script>
</body>
</html>