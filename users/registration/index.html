<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Register - 3 Ball Network</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Google Fonts: Urbanist & Montserrat for a modern, energetic look -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Urbanist:wght@400;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/style.css">
  <style>
    body {
      font-family: 'Urbanist', 'Montserrat', Arial, sans-serif;
      margin: 0;
      background: linear-gradient(135deg, #007cba 0%, #00b4d8 100%);
      color: #222;
      min-height: 100vh;
      overflow-x: hidden;
      letter-spacing: 0.02em;
    }
    .banner-logo {
      width: 100vw;
      background: #111;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 1.5em 0 1em 0;
      margin: 0;
    }
    .banner-logo-img {
      max-width: 320px;
      width: 90vw;
      height: auto;
      display: block;
      filter: drop-shadow(0 8px 32px rgba(0,0,0,0.18));
      border-radius: 24px;
      background: none;
      padding: 0.5em 1.5em;
      box-shadow: 0 2px 16px rgba(0,0,0,0.10);
      border: none;
    }
    @media (max-width: 700px) {
      .banner-logo-img { max-width: 90vw; padding: 0.5em; }
      .banner-logo { padding: 1em 0 0.5em 0; }
    }
    header {
      background: transparent;
      text-align: center;
      padding: 3em 1em 1.5em 1em;
      position: relative;
    }
    .site-title {
      font-family: 'Montserrat', 'Urbanist', Arial, sans-serif;
      font-size: 3em;
      font-weight: 900;
      letter-spacing: 3px;
      color: #fff;
      margin: 0.2em 0 0.1em 0;
      text-shadow: 0 6px 24px rgba(0,0,0,0.18);
      text-transform: uppercase;
    }
    .site-tagline {
      font-family: 'Urbanist', Arial, sans-serif;
      color: #e0fbfc;
      font-size: 1.35em;
      margin-bottom: 0.7em;
      letter-spacing: 1.5px;
      font-weight: 700;
      text-shadow: 0 2px 8px rgba(0,0,0,0.10);
    }
    nav {
      background: rgba(255,255,255,0.98);
      padding: 1.1em 0;
      box-shadow: 0 2px 12px rgba(0,0,0,0.04);
      text-align: center;
      border-radius: 0 0 22px 22px;
      margin: 0 auto 2em auto;
      max-width: 720px;
      font-size: 1.18em;
      font-family: 'Montserrat', Arial, sans-serif;
    }
    nav a {
      margin: 0 1.5em;
      color: #007cba;
      text-decoration: none;
      font-weight: 900;
      letter-spacing: 0.5px;
      transition: color 0.2s;
      position: relative;
      text-transform: uppercase;
    }
    nav a::after {
      content: "";
      display: block;
      width: 0;
      height: 2.5px;
      background: linear-gradient(90deg, #00b4d8 0%, #007cba 100%);
      transition: width 0.3s;
      margin: 0 auto;
      border-radius: 2px;
    }
    nav a:hover {
      color: #00b4d8;
    }
    nav a:hover::after {
      width: 100%;
    }
    .register-hero {
      max-width: 750px;
      margin: 2.5em auto 2em auto;
      background: rgba(255,255,255,0.99);
      border-radius: 28px;
      box-shadow: 0 8px 36px rgba(0,0,0,0.16);
      padding: 3em 2em 2.5em 2em;
      text-align: center;
      position: relative;
      overflow: hidden;
      font-family: 'Urbanist', Arial, sans-serif;
      animation: fadeInUp 0.9s cubic-bezier(.4,0,.2,1);
    }
    .register-hero h2 {
      font-size: 2.1em;
      margin-bottom: 0.5em;
      color: #007cba;
      font-weight: 900;
      letter-spacing: 1.5px;
      font-family: 'Montserrat', Arial, sans-serif;
      text-transform: uppercase;
    }
    .register-hero p {
      font-size: 1.18em;
      color: #444;
      margin-bottom: 2em;
      font-family: 'Urbanist', Arial, sans-serif;
    }
    form {
      width: 100%;
      max-width: 420px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 1em;
      background: none;
    }
    label {
      font-family: 'Montserrat', Arial, sans-serif;
      font-weight: 700;
      color: #007cba;
      margin-bottom: 0.2em;
      margin-top: 0.5em;
      font-size: 1em;
      text-align: left;
    }
    input, select {
      width: 100%;
      padding: 0.7em 1em;
      border: 1.5px solid #e0e0e0;
      border-radius: 8px;
      font-size: 1em;
      font-family: 'Urbanist', Arial, sans-serif;
      background: #f9f9f9;
      margin-bottom: 0.2em;
      transition: border 0.2s;
    }
    input:focus, select:focus {
      border-color: #007cba;
      outline: none;
      background: #fff;
    }
    button[type="submit"] {
      background: #007cba;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 1em;
      font-family: 'Montserrat', Arial, sans-serif;
      font-weight: 900;
      font-size: 1.1em;
      letter-spacing: 1px;
      cursor: pointer;
      margin-top: 1em;
      transition: background 0.2s;
    }
    button[type="submit"]:hover {
      background: #00b4d8;
    }
    .login-link {
      margin-top: 1.5em;
      text-align: center;
      color: #444;
      font-size: 1em;
    }
    .login-link a {
      color: #007cba;
      text-decoration: none;
      font-weight: 700;
    }
    .login-link a:hover {
      text-decoration: underline;
    }
    #register-loading {
      text-align: center;
      color: #007cba;
      font-weight: 700;
      margin-top: 0.5em;
    }
    #reg-error {
      color: #d90429;
      font-weight: 700;
      text-align: center;
      margin-top: 0.5em;
    }
    .password-container {
      display: flex;
      align-items: center;
      gap: 0.5em;
    }
    .password-container input {
      flex: 1;
      margin-bottom: 0;
    }
    .password-container button {
      background: #e0e0e0;
      border: none;
      border-radius: 6px;
      padding: 0.5em 1em;
      font-size: 0.95em;
      cursor: pointer;
      color: #007cba;
      font-family: 'Montserrat', Arial, sans-serif;
      font-weight: 700;
      transition: background 0.2s;
    }
    .password-container button:hover {
      background: #b2e0f7;
    }
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(30px);}
      to { opacity: 1; transform: translateY(0);}
    }
    @media (max-width: 700px) {
      .register-hero { max-width: 98vw; padding: 1em; }
      .site-title { font-size: 2em; }
    }
  </style>
</head>
<body>
  <div class="banner-logo">
    <img src="../../Media/logo.png" alt="3 Ball Network Logo" class="banner-logo-img">
  </div>
  <header>
    <div class="site-title">3 Ball Network</div>
    <div class="site-tagline">Connecting Players, Coaches, Scouts, and Fans</div>
  </header>
  <nav>
    <a href="/">Home</a>
    <a href="/users/registration/">Register</a>
    <a href="/users/login.html">Login</a>
  </nav>
  <div class="register-hero">
    <h2>Register</h2>
    <p>Join the 3 Ball Network and connect with players, coaches, scouts, and fans!</p>
    <form id="register-form" autocomplete="off" enctype="multipart/form-data">
      <label for="reg-email">Email</label>
      <input type="email" id="reg-email" required autocomplete="username">
      <label for="reg-password">Create Password</label>
      <span class="password-container">
        <input type="password" id="reg-password" required pattern="(?=.*[A-Z])(?=.*[a-z])(?=.*\d).{8,}" title="At least 8 characters, 1 uppercase, 1 lowercase, 1 number">
        <button type="button" id="toggle-password">Show</button>
      </span>
      <label for="reg-photo">Profile Photo</label>
      <input type="file" id="reg-photo" name="photo" accept="image/*" required>
      <label for="reg-role">Role</label>
      <select id="reg-role" required>
        <option value="">Select Role</option>
        <option value="player">Player</option>
        <option value="coach">Coach</option>
        <option value="scout">Scout</option>
        <option value="fan">Fan</option>
      </select>
      <div id="role-fields"></div>
      <button type="submit">Register</button>
      <div id="register-loading" style="display:none;">Loading...</div>
      <div id="reg-error"></div>
    </form>
    <div class="login-link">
      Already have an account? <a href="../login.html">Login here</a>
    </div>
  </div>
  <!-- Firebase App (the core Firebase SDK) -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<!-- Auth -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
<!-- Firestore -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
<!-- Storage -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-storage-compat.js"></script>
<script>
  // Your web app's Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyD4XJLc3_CLvOhvMsytQx2fabgZQt3y5g0",
    authDomain: "ball-network-web.firebaseapp.com",
    projectId: "ball-network-web",
    storageBucket: "ball-network-web.appspot.com",
    messagingSenderId: "749015998465",
    appId: "1:749015998465:web:59ac026f3f4c2ec5da3500",
    measurementId: "G-ZS07SKSRRL"
  };
  firebase.initializeApp(firebaseConfig);
</script>
  <script>
const roleFields = document.getElementById('role-fields');
const roleSelect = document.getElementById('reg-role');

function getStateOptions() {
  const states = [
    { abbr: "AL", name: "Alabama" }, { abbr: "AK", name: "Alaska" }, { abbr: "AZ", name: "Arizona" },
    { abbr: "AR", name: "Arkansas" }, { abbr: "CA", name: "California" }, { abbr: "CO", name: "Colorado" },
    { abbr: "CT", name: "Connecticut" }, { abbr: "DE", name: "Delaware" }, { abbr: "FL", name: "Florida" },
    { abbr: "GA", name: "Georgia" }, { abbr: "HI", name: "Hawaii" }, { abbr: "ID", name: "Idaho" },
    { abbr: "IL", name: "Illinois" }, { abbr: "IN", name: "Indiana" }, { abbr: "IA", name: "Iowa" },
    { abbr: "KS", name: "Kansas" }, { abbr: "KY", name: "Kentucky" }, { abbr: "LA", name: "Louisiana" },
    { abbr: "ME", name: "Maine" }, { abbr: "MD", name: "Maryland" }, { abbr: "MA", name: "Massachusetts" },
    { abbr: "MI", name: "Michigan" }, { abbr: "MN", name: "Minnesota" }, { abbr: "MS", name: "Mississippi" },
    { abbr: "MO", name: "Missouri" }, { abbr: "MT", name: "Montana" }, { abbr: "NE", name: "Nebraska" },
    { abbr: "NV", name: "Nevada" }, { abbr: "NH", name: "New Hampshire" }, { abbr: "NJ", name: "New Jersey" },
    { abbr: "NM", name: "New Mexico" }, { abbr: "NY", name: "New York" }, { abbr: "NC", name: "North Carolina" },
    { abbr: "ND", name: "North Dakota" }, { abbr: "OH", name: "Ohio" }, { abbr: "OK", name: "Oklahoma" },
    { abbr: "OR", name: "Oregon" }, { abbr: "PA", name: "Pennsylvania" }, { abbr: "RI", name: "Rhode Island" },
    { abbr: "SC", name: "South Carolina" }, { abbr: "SD", name: "South Dakota" }, { abbr: "TN", name: "Tennessee" },
    { abbr: "TX", name: "Texas" }, { abbr: "UT", name: "Utah" }, { abbr: "VT", name: "Vermont" },
    { abbr: "VA", name: "Virginia" }, { abbr: "WA", name: "Washington" }, { abbr: "WV", name: "West Virginia" },
    { abbr: "WI", name: "Wisconsin" }, { abbr: "WY", name: "Wyoming" }
  ];
  return `<option value="">Select State</option>` +
    states.map(state => `<option value="${state.abbr}">${state.name}</option>`).join('');
}

function getCommonFields(role) {
  return `
    <label for="${role}-first">First Name</label>
    <input type="text" id="${role}-first" required>
    <label for="${role}-last">Last Name</label>
    <input type="text" id="${role}-last" required>
    <label for="${role}-state">State</label>
    <select id="${role}-state" required>${getStateOptions()}</select>
    <label for="${role}-city">City</label>
    <input type="text" id="${role}-city" required placeholder="Enter your city">
    ${(role === "player" || role === "coach") ? `
      <label for="${role}-school">School</label>
      <input type="text" id="${role}-school" required placeholder="Enter your school">
    ` : ""}
    <label for="${role}-phone">Phone Number</label>
    <input type="tel" id="${role}-phone" required pattern="[0-9]{10,}">
  `;
}

const fieldsByRole = {
  player: getCommonFields("player") + `
    <label>Position(s)</label>
    <div id="player-positions-checkboxes" style="display:flex;gap:1em;justify-content:center;margin-bottom:1em;">
      <label><input type="checkbox" name="player-position" value="guard"> Guard</label>
      <label><input type="checkbox" name="player-position" value="forward"> Forward</label>
      <label><input type="checkbox" name="player-position" value="center"> Center</label>
    </div>
    <label for="player-height-ft">Height</label>
    <div style="display:flex;gap:0.5em;">
      <input type="number" id="player-height-ft" min="4" max="7" placeholder="Feet" required style="flex:1;">
      <input type="number" id="player-height-in" min="0" max="11" placeholder="Inches" required style="flex:1;">
    </div>
    <label for="player-weight">Weight (lbs)</label>
    <input type="number" id="player-weight" min="80" max="400" required>
    <label>Gender</label>
    <select id="player-gender" required>
      <option value="">Select Gender</option>
      <option value="male">Male</option>
      <option value="female">Female</option>
    </select>
  `,
  coach: getCommonFields("coach") + `
    <label>Level(s) Coached</label>
    <div id="coach-levels-checkboxes" style="display:flex;gap:1em;justify-content:center;margin-bottom:1em;">
      <label><input type="checkbox" name="coach-level" value="Middle School"> Middle School</label>
      <label><input type="checkbox" name="coach-level" value="High School"> High School</label>
      <label><input type="checkbox" name="coach-level" value="AAU"> AAU</label>
      <label><input type="checkbox" name="coach-level" value="Both"> Both</label>
    </div>
  `,
  scout: getCommonFields("scout"),
  fan: getCommonFields("fan")
};

roleSelect.addEventListener('change', function() {
  roleFields.innerHTML = fieldsByRole[this.value] || '';
});

document.addEventListener('DOMContentLoaded', () => {
  const pwInput = document.getElementById('reg-password');
  const pwBtn = document.getElementById('toggle-password');
  if (pwBtn && pwInput) {
    pwBtn.onclick = () => {
      if (pwInput.type === "password") {
        pwInput.type = "text";
        pwBtn.textContent = "Hide";
      } else {
        pwInput.type = "password";
        pwBtn.textContent = "Show";
      }
    };
  }
});

// Capitalize first letter of each word for name, city, school fields
function capitalizeWords(str) {
  return str.replace(/\b\w/g, c => c.toUpperCase());
}

document.getElementById('register-form').addEventListener('submit', async function(e) {
  e.preventDefault();
  document.getElementById('register-loading').style.display = 'block';
  document.getElementById('reg-error').textContent = '';
  const email = document.getElementById('reg-email').value;
  const password = document.getElementById('reg-password').value;
  const photoFile = document.getElementById('reg-photo').files[0];
  const role = document.getElementById('reg-role').value;

  // Get role-specific fields
  const firstName = capitalizeWords(document.getElementById(`${role}-first`).value);
  const lastName = capitalizeWords(document.getElementById(`${role}-last`).value);
  const state = document.getElementById(`${role}-state`).value;
  const city = capitalizeWords(document.getElementById(`${role}-city`).value);
  const phoneNumber = document.getElementById(`${role}-phone`).value;
  let school = "";
  if (role === "player" || role === "coach") {
    school = capitalizeWords(document.getElementById(`${role}-school`).value);
  }

  // Get checked positions for player
  let positions = [];
  if (role === "player") {
    positions = Array.from(document.querySelectorAll('input[name="player-position"]:checked')).map(cb => cb.value);
    if (positions.length === 0) {
      document.getElementById('reg-error').textContent = "Please select at least one position.";
      return;
    }
  }

  // Get checked levels for coach
  let coachLevels = [];
  if (role === "coach") {
    coachLevels = Array.from(document.querySelectorAll('input[name="coach-level"]:checked')).map(cb => cb.value);
    if (coachLevels.length === 0) {
      document.getElementById('reg-error').textContent = "Please select at least one level coached.";
      return;
    }
  }

  // Player extra fields
  let heightFt = "", heightIn = "", weight = "", gender = "";
  if (role === "player") {
    heightFt = document.getElementById('player-height-ft').value;
    heightIn = document.getElementById('player-height-in').value;
    weight = document.getElementById('player-weight').value;
    gender = document.getElementById('player-gender').value;
  }

  try {
    // 1. Create user in Firebase Auth
    const userCredential = await firebase.auth().createUserWithEmailAndPassword(email, password);
    const user = userCredential.user;
    const userId = user.uid;

    // 2. Upload photo to Firebase Storage
    const storageRef = firebase.storage().ref(`profile_photos/${user.uid}`);
    await storageRef.put(photoFile);
    const photoURL = await storageRef.getDownloadURL();

    // 3. Save user info to Firestore
    const userData = {
      userId,
      email,
      role,
      firstName,
      lastName,
      state,
      city,
      phoneNumber,
      school,
      photoURL,
      positions,
      coachLevels,
      heightFt,
      heightIn,
      weight,
      gender
    };

    await firebase.firestore().collection('users').doc(userId).set(userData);

    alert('Registration successful!');
    // Redirect or show success message
  } catch (error) {
    document.getElementById('reg-error').textContent = error.message;
  }
  document.getElementById('register-loading').style.display = 'none';
});
  </script>
</body>
</html>